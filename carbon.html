<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Carbon Dioxide (CO2) Molecule</title>
    <style>
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            color: #e0e0e0;
            background-color: #121212;
            overflow: hidden; /* Prevent scrollbars from appearing */
        }
        #info {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display: block;
            padding: 0 20px;
            box-sizing: border-box;
        }
        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin: 0;
            color: #ffffff;
        }
        p {
            font-size: 1rem;
            margin-top: 8px;
            color: #a0a0a0;
        }
        /* Style for the atom labels */
        .label {
            color: #FFF;
            font-size: 24px;
            font-weight: bold;
            text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
            /* This transform centers the label on its new 3D anchor point */
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none; /* Allow mouse events to pass through to the canvas */
        }
    </style>
</head>
<body>

    <div id="info">
        <h1>Carbon Dioxide (COâ‚‚) Molecule</h1>
        <p>Drag to rotate, scroll to zoom</p>
    </div>

    <!-- This import map allows us to use modules directly from the CDN -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        let scene, camera, renderer, controls, css2dRenderer;
        let molecule;

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 8;

            // WebGL Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // CSS2D Renderer for labels
            css2dRenderer = new CSS2DRenderer();
            css2dRenderer.setSize(window.innerWidth, window.innerHeight);
            css2dRenderer.domElement.style.position = 'absolute';
            css2dRenderer.domElement.style.top = '0px';
            document.body.appendChild(css2dRenderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 5, 5).normalize();
            scene.add(directionalLight);
            
            // Controls setup - attached to the label renderer to capture events
            controls = new OrbitControls(camera, css2dRenderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 3;
            controls.maxDistance = 20;

            // Create the molecule
            createMolecule();

            // Event Listeners
            window.addEventListener('resize', onWindowResize, false);
            
            // Start animation loop
            animate();
        }

        function createMolecule() {
            // A group to hold all parts of the molecule
            molecule = new THREE.Group();
            scene.add(molecule);

            // Atom properties
            const carbonRadius = 0.7;
            const oxygenRadius = 0.55;
            const bondDistance = 1.8;
            const bondRadius = 0.12;
            const doubleBondOffset = 0.2;

            // Materials
            const carbonMaterial = new THREE.MeshStandardMaterial({ color: 0x282828, roughness: 0.5, metalness: 0.2 });
            const oxygenMaterial = new THREE.MeshStandardMaterial({ color: 0xcc0000, roughness: 0.5, metalness: 0.2 });
            const bondMaterial = new THREE.MeshStandardMaterial({ color: 0x888888, roughness: 0.8, metalness: 0.1 });

            // Helper function to create a label
            function createLabel(text) {
                const div = document.createElement('div');
                div.className = 'label';
                div.textContent = text;
                const label = new CSS2DObject(div);
                label.position.set(0, 0, 0);
                return label;
            }

            // Carbon atom (center)
            const carbonGeometry = new THREE.SphereGeometry(carbonRadius, 32, 32);
            const carbonAtom = new THREE.Mesh(carbonGeometry, carbonMaterial);
            molecule.add(carbonAtom);
            const carbonLabel = createLabel('C');
            carbonLabel.position.y = -(carbonRadius + 0.3); // Position label anchor below the atom
            molecule.add(carbonLabel); // Add to the main group


            // Oxygen atoms
            const oxygenGeometry = new THREE.SphereGeometry(oxygenRadius, 32, 32);
            
            const oxygenAtom1 = new THREE.Mesh(oxygenGeometry, oxygenMaterial);
            oxygenAtom1.position.x = bondDistance;
            molecule.add(oxygenAtom1);
            const oxygenLabel1 = createLabel('O');
            oxygenLabel1.position.x = bondDistance; // Match atom's x position
            oxygenLabel1.position.y = -(oxygenRadius + 0.3); // Position label anchor below the atom
            molecule.add(oxygenLabel1); // Add to the main group
            
            const oxygenAtom2 = new THREE.Mesh(oxygenGeometry, oxygenMaterial);
            oxygenAtom2.position.x = -bondDistance;
            molecule.add(oxygenAtom2);
            const oxygenLabel2 = createLabel('O');
            oxygenLabel2.position.x = -bondDistance; // Match atom's x position
            oxygenLabel2.position.y = -(oxygenRadius + 0.3); // Position label anchor below the atom
            molecule.add(oxygenLabel2); // Add to the main group

            // Double bonds
            const bondGeometry = new THREE.CylinderGeometry(bondRadius, bondRadius, bondDistance, 16);
            
            // Helper function to create a double bond
            function createDoubleBond(direction) {
                const bondGroup = new THREE.Group();
                
                const bond1 = new THREE.Mesh(bondGeometry, bondMaterial);
                bond1.position.y = doubleBondOffset / 2;
                
                const bond2 = new THREE.Mesh(bondGeometry, bondMaterial);
                bond2.position.y = -doubleBondOffset / 2;

                bondGroup.add(bond1);
                bondGroup.add(bond2);
                
                // Position and orient the bond group
                bondGroup.position.x = direction * bondDistance / 2;
                bondGroup.rotation.z = Math.PI / 2; // Rotate to be horizontal
                
                molecule.add(bondGroup);
            }

            createDoubleBond(1);  // Bond to the right oxygen
            createDoubleBond(-1); // Bond to the left oxygen
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            css2dRenderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // only required if controls.enableDamping = true
            
            // Optional: add a slight rotation
            if (molecule) {
               molecule.rotation.y += 0.002;
            }

            renderer.render(scene, camera);
            css2dRenderer.render(scene, camera);
        }

        // Run the simulation
        init();

    </script>
</body>
</html>



